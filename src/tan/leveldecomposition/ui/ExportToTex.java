/*
 * ExportToTex.java
 *
 * Created on 19 april 2007, 16:47
 */

package tan.leveldecomposition.ui;

import tan.leveldecomposition.*;

import javax.swing.JTable;
import javax.swing.JDialog;
import javax.swing.JFileChooser;
import javax.swing.filechooser.*;
import java.io.File;
import java.io.FileWriter;
import java.io.IOException;
import tan.leveldecomposition.ui.reusable.UIPrintableColorTable;


/**
 *
 * @author  Teake Nutma
 */
public class ExportToTex extends javax.swing.JPanel
{
	private FileFilter texFilter;
	private JDialog parent;
	private UIPrintableColorTable repTable;
	
	/** Creates new form ExportToTex */
	public ExportToTex()
	{
		initComponents();
		texFilter = new FileNameExtensionFilter("LaTeX file (*.tex)", "tex");
	}
	
	public void setup(JDialog parent, UIPrintableColorTable repTable)
	{
		this.parent = parent;
		this.repTable = repTable;
	}
	
	/** This method is called from within the constructor to
	 * initialize the form.
	 * WARNING: Do NOT modify this code. The content of this method is
	 * always regenerated by the Form Editor.
	 */
    // <editor-fold defaultstate="collapsed" desc=" Generated Code ">//GEN-BEGIN:initComponents
    private void initComponents()
    {
        cbDD = new javax.swing.JCheckBox();
        cbReps = new javax.swing.JCheckBox();
        cbCaption = new javax.swing.JCheckBox();
        export = new javax.swing.JButton();
        cancel = new javax.swing.JButton();

        cbDD.setText("Export Dynkin diagram");
        cbDD.setBorder(javax.swing.BorderFactory.createEmptyBorder(0, 0, 0, 0));
        cbDD.setMargin(new java.awt.Insets(0, 0, 0, 0));

        cbReps.setText("Export representation table");
        cbReps.setBorder(javax.swing.BorderFactory.createEmptyBorder(0, 0, 0, 0));
        cbReps.setMargin(new java.awt.Insets(0, 0, 0, 0));

        cbCaption.setText("Include captions");
        cbCaption.setBorder(javax.swing.BorderFactory.createEmptyBorder(0, 0, 0, 0));
        cbCaption.setMargin(new java.awt.Insets(0, 0, 0, 0));

        export.setText("Export");
        export.addActionListener(new java.awt.event.ActionListener()
        {
            public void actionPerformed(java.awt.event.ActionEvent evt)
            {
                exportActionPerformed(evt);
            }
        });

        cancel.setText("Cancel");
        cancel.addActionListener(new java.awt.event.ActionListener()
        {
            public void actionPerformed(java.awt.event.ActionEvent evt)
            {
                cancelActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(this);
        this.setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(cbDD)
                    .addComponent(cbReps)
                    .addComponent(cbCaption)
                    .addGroup(layout.createSequentialGroup()
                        .addComponent(export)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(cancel)))
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(cbDD)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(cbReps)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(cbCaption)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(export)
                    .addComponent(cancel))
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );
    }// </editor-fold>//GEN-END:initComponents
	
	private void cancelActionPerformed(java.awt.event.ActionEvent evt)//GEN-FIRST:event_cancelActionPerformed
	{//GEN-HEADEREND:event_cancelActionPerformed
		parent.setVisible(false);
	}//GEN-LAST:event_cancelActionPerformed
	
	private void exportActionPerformed(java.awt.event.ActionEvent evt)//GEN-FIRST:event_exportActionPerformed
	{//GEN-HEADEREND:event_exportActionPerformed
		parent.setVisible(false);
		
		JFileChooser chooser = new JFileChooser("");
		chooser.setSelectedFile(new File(Globals.getDynkinDiagramType() + ".tex"));
		chooser.addChoosableFileFilter(texFilter);
		chooser.setDialogTitle("Export to TeX");
		int returnVal = chooser.showSaveDialog(this);
		
		if ( returnVal == chooser.APPROVE_OPTION )
		{
		/* To create a URL for a file on the local file-system, we simply
		 * pre-pend the "file" protocol to the absolute path of the file.
		 */
			String fileURL = chooser.getSelectedFile().getAbsolutePath();
			if(!texFilter.accept(chooser.getSelectedFile()))
				fileURL += ".rs";
			// write it out
			FileWriter outputStream = null;
			try
			{
				outputStream = new FileWriter(fileURL);
				String output = repTable.toTeX(cbCaption.isSelected());
				outputStream.write(output);
				outputStream.close();
			}
			catch (IOException e)
			{
				e.printStackTrace();
			}
		}
	}//GEN-LAST:event_exportActionPerformed
	
	
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton cancel;
    private javax.swing.JCheckBox cbCaption;
    private javax.swing.JCheckBox cbDD;
    private javax.swing.JCheckBox cbReps;
    private javax.swing.JButton export;
    // End of variables declaration//GEN-END:variables
	
}
